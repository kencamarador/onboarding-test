on:
  repository_dispatch:
  
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Echo Key
        env:
          KEY: ${{ github.event.client_payload.key }}
          FIRSTNAME: ${{ github.event.client_payload.firstname }}
          LASTNAME: ${{ github.event.client_payload.lastname }}
        run: |
          echo $FIRSTNAME $LASTNAME
          CLIENT_ID=${{ vars.CLIENT_ID }}
          CLIENT_SECRET=${{ secrets.CLIENT_SECRET }}
          TOKEN=${{ secrets.TOKEN }}


          echo "Got the token"
          echo "Access Token: $TOKEN"
          
          PASSWORD=$(openssl rand -base64 12 | tr -d '\n')

          curl -X POST -H "Authorization: Bearer $TOKEN" -H "Content-type: application/json" \
          -d '{
            "accountEnabled": false,
            "displayName": "'"$FIRSTNAME $LASTNAME"'",
            "mailNickname": "$FIRSTNAME $LASTNAME",
            "userPrincipalName": "'"$FIRSTNAME.$LASTNAME@kencamarador.com"'",
            "passwordProfile": {
              "forceChangePasswordNextSignIn": true,
              "password": "'"$PASSWORD"'"
            }
          }' \
          https://graph.microsoft.com/v1.0/users



